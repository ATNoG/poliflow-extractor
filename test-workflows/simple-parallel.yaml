id: paralllel
name: paralllel
version: '0.1.0'
specVersion: '0.8'
description: Parallel routing example
start: entry-event

events:
  - name: triggerEvent
    type: http.request.received
    source: http-event-sources
    kind: consumed

# https://sonataflow.org/serverlessworkflow/latest/core/custom-functions-support.html#con-func-knative
functions:
  - name: function-a
    type: custom
    operation: knative:services.v1.serving.knative.dev/function-a?method=GET&returnHeaders=true
  - name: function-b
    type: custom
    operation: knative:services.v1.serving.knative.dev/function-b?method=GET&returnHeaders=true
  - name: function-c
    type: custom
    operation: knative:services.v1.serving.knative.dev/function-c?method=GET&returnHeaders=true
  - name: result
    type: custom
    operation: knative:services.v1.serving.knative.dev/result?method=POST

states:
  - name: entry-event
    type: event
    onEvents:
      - eventRefs:
          - triggerEvent
        eventDataFilter:
          data: "${ . }"
    transition: function-a

  - name: function-a
    type: operation
    actions:
      - functionRef:
          refName: function-a
    transition: parallel

  - name: parallel
    type: parallel
    branches:
      - name: branch-b
        actions:
          - functionRef:
              refName: function-b
      - name: branch-c
        actions:
          - functionRef:
              refName: function-c
    transition: result

  - name: result
    type: operation
    actions:
      - functionRef:
          refName: result
    end: true
